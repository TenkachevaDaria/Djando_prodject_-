{% extends "pattern.html" %}
{% load static %}
{% load basket_tags %}

{% block css %}
<link rel="stylesheet" href="{% static "ccs/basket_page.css" %}">
<link rel="stylesheet" href="{% static "ccs/order_page.css" %}">
<link rel="stylesheet" href="{% static "adaptation/order_media.css" %}">
{% endblock  %}

{% block content %}
    <div class="basket_container">
        <div>
            <h2 class="basket__title">Ваш заказ</h2>
            <ul class="basket__item_list">
                {% user_basket request as baskets %}
                {% for basket_user in baskets %}
                    <li class="basket__item">
                        <div class="item_box">
                            {% if basket_user.product.image %}
                                <div class="img_decor_card">
                                    <img src="{{ basket_user.product.image.url }}" alt="" class="item__img">
                                </div>
                            {% else %}
                                <img src="{% static 'deps/отсутсвует.png' %}" alt="" class="item__img">
                            {% endif %}
        
                            <div class="pos_box_price">
                                <h3 class="item__name">{{ basket_user.product.name|truncatechars:33 }}</h3>
                                <p class="item__price">{{ basket_user.products_price }}  ₽</p>
                                <p class="item__sort_descr">{{ basket_user.product.description|truncatechars:35 }}</p>
                                <p class="item__platform">{{ basket_user.product.category }}</p>
                                <div class="item__counter_box">               
                                    <p type="text" class="quantity number_order">{{ basket_user.quantity }} шт.</p>
                                </div>
                            </div>
                        </div>
                    </li> 
                {% endfor %}
        
            </ul>
        </div>
        <div class="right_basket_container">
            <form action="{% url "orders:create_order" %}" method="post">
                {% csrf_token %}

                <h3 class="payment_way__title">Способ оплаты</h3>

                {% if user.payment_method %}
                    <input type="hidden" name="payment_method" id="id_payment_method" value="{{ user.payment_method.id }}">
                    <p class="payment_way__card">{{user.payment_method.bank }} ⋅⋅ {{ user.payment_method.card_num|slice:"-4:" }}</p>
                {% else %}
                    <p class="payment_way__card">Карта не была выбрана</p>
                {% endif %}

                <h3 class="email_to_send">Адрес эл.почты</h3>

                {% if not user.is_authenticated %}
                    <input type="email" id="id_email" name="email" placeholder="почта" class="order_email" required><br>
                {% else %}
                    <input type="email" id="id_email" name="email" value="{{ user.email }}" placeholder="почта" class="order_email" required><br>
                {% endif %}

                <p id="products-in-basket-count" class="products_counter">Товары, {{ baskets.total_quantity }} шт.</p>
                <div class="total_price_container">
                    <p class="total_price_name"><b>Итого</b></p>
                    <p class="total_price_num"><b>{{ baskets.total_price }} &#8381;</b></p>
                </div>
                <button class="order_btn btn"><b>Оформить</b></button>
            </form>
        </div>
    </div>
    <script>
        document.querySelectorAll('input[type=radio][name=payment_method]').forEach(function(radio) {
            radio.addEventListener('change', function() {
                if (this.checked) {
                    var selectedPaymentMethodId = this.value;
                    document.getElementById('id_payment_method').value = selectedPaymentMethodId;
                }
            });
        });
    </script>
{% endblock  %}

{% block decorLine %}
    <svg width="1728" height="934" viewBox="0 0 1728 934" fill="none" xmlns="http://www.w3.org/2000/svg" class="backimg_order">
        <g opacity="0.45">
        <g filter="url(#filter0_f_1062_5261)">
        <path d="M0 90H107.5C118.546 90 127.5 98.9543 127.5 110V744.5C127.5 755.546 136.454 764.5 147.5 764.5H737.5C748.546 764.5 757.5 773.454 757.5 784.5V903C757.5 914.046 766.454 923 777.5 923H1536C1547.05 923 1556 914.046 1556 903V766.5C1556 755.454 1564.95 746.5 1576 746.5H1731.5" stroke="#0082F0"/>
        </g>
        <g filter="url(#filter1_f_1062_5261)">
        <path d="M1720.5 140.5H1185.5C1174.45 140.5 1165.5 149.454 1165.5 160.5V776C1165.5 787.046 1156.55 796 1145.5 796H605.5H320C308.954 796 300 787.046 300 776V508C300 496.954 291.046 488 280 488H104C92.9543 488 84 496.954 84 508V868.5C84 879.546 75.0457 888.5 64 888.5H-2.5" stroke="#8AC7FE" stroke-width="2"/>
        </g>
        <g filter="url(#filter2_f_1062_5261)">
        <path d="M7 11.5H775.5C786.546 11.5 795.5 20.4543 795.5 31.5V286.5C795.5 297.546 786.546 306.5 775.5 306.5H355C343.954 306.5 335 315.454 335 326.5V594C335 605.046 343.954 614 355 614H1548.5C1559.55 614 1568.5 605.046 1568.5 594V347C1568.5 335.954 1577.45 327 1588.5 327H1729" stroke="#8AC7FE" stroke-width="2"/>
        </g>
        </g>
        <defs>
        <filter id="filter0_f_1062_5261" x="-10" y="79.5" width="1751.5" height="854" filterUnits="userSpaceOnUse" color-interpolation-filters="sRGB">
        <feFlood flood-opacity="0" result="BackgroundImageFix"/>
        <feBlend mode="normal" in="SourceGraphic" in2="BackgroundImageFix" result="shape"/>
        <feGaussianBlur stdDeviation="5" result="effect1_foregroundBlur_1062_5261"/>
        </filter>
        <filter id="filter1_f_1062_5261" x="-12.5" y="129.5" width="1743" height="770" filterUnits="userSpaceOnUse" color-interpolation-filters="sRGB">
        <feFlood flood-opacity="0" result="BackgroundImageFix"/>
        <feBlend mode="normal" in="SourceGraphic" in2="BackgroundImageFix" result="shape"/>
        <feGaussianBlur stdDeviation="5" result="effect1_foregroundBlur_1062_5261"/>
        </filter>
        <filter id="filter2_f_1062_5261" x="-3" y="0.5" width="1742" height="624.5" filterUnits="userSpaceOnUse" color-interpolation-filters="sRGB">
        <feFlood flood-opacity="0" result="BackgroundImageFix"/>
        <feBlend mode="normal" in="SourceGraphic" in2="BackgroundImageFix" result="shape"/>
        <feGaussianBlur stdDeviation="5" result="effect1_foregroundBlur_1062_5261"/>
        </filter>
        </defs>
    </svg>
{% endblock  %}